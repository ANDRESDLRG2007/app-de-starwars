<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Star Wars - Diagn√≥stico Completo</title>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: #000;
            color: #FFE81F;
            padding: 2rem;
            text-align: center;
        }
        h1 {
            text-shadow: 0 0 10px #FFE81F;
        }
        .card {
            display: inline-block;
            background: #1a1a1a;
            border: 2px solid #FFE81F;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem;
            width: 240px;
        }
        img {
            width: 200px;
            height: 280px;
            object-fit: cover;
            border-radius: 8px;
            background: #0a0a0a;
        }
        button {
            background: #FFE81F;
            color: #000;
            border: none;
            padding: 1rem 2rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 1rem;
            transition: 0.2s;
        }
        button:hover {
            transform: scale(1.05);
            background: #fff27a;
        }
        #resultado {
            margin-top: 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .log {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: #aaa;
            text-align: left;
            width: 80%;
            max-width: 700px;
            background: #111;
            padding: 1rem;
            border-radius: 10px;
            border-left: 4px solid #FFE81F;
        }
        .diagnostico {
            text-align: left;
            background: #111;
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid #FFE81F;
            max-width: 800px;
            margin: 2rem auto;
        }
        details {
            margin-top: 1rem;
        }
        summary {
            cursor: pointer;
            font-weight: bold;
        }
        summary:hover {
            color: #fff27a;
        }
    </style>
</head>
<body>
    <h1>üß™ Star Wars Diagnostic Tester</h1>
    <p>Verifica conexi√≥n, rendimiento e im√°genes con SWAPI.tech y la API de GitHub</p>

    <button onclick="testAPI()">üöÄ Testear Conexi√≥n</button>
    <button onclick="randomTest()">üîÄ Test Aleatorio</button>
    <button onclick="verificarRecursos()">üìä Diagn√≥stico Completo</button>

    <div id="resultado"></div>
    <div class="log" id="log"></div>

    <!-- üß© Secci√≥n de diagn√≥stico extendido -->
    <div id="diagnostico"></div>

    <script>
        const BASE_URL = 'https://www.swapi.tech/api';
        const IMG_BASE = 'https://akabab.github.io/starwars-api/api/all.json';
        let githubData = [];

        async function testAPI() {
            const res = document.getElementById('resultado');
            const log = document.getElementById('log');
            res.innerHTML = '<p>‚è≥ Cargando...</p>';
            log.innerHTML = 'üîç Iniciando test...';

            const inicio = performance.now();
            try {
                const swapiRes = await fetch(`${BASE_URL}/people/1`);
                const swapiData = await swapiRes.json();
                const personaje = swapiData.result.properties;

                const gitRes = await fetch(IMG_BASE);
                githubData = await gitRes.json();

                const tiempo = (performance.now() - inicio).toFixed(2);
                const match = githubData.find(p => p.name === personaje.name);
                const imgUrl = match ? match.image : '';

                res.innerHTML = `
                    <div class="card">
                        <h3>${personaje.name}</h3>
                        <img src="${imgUrl || 'https://starwars-visualguide.com/assets/img/characters/1.jpg'}"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27200%27 height=%27280%27%3E%3Crect fill=%27%23000%27 width=%27200%27 height=%27280%27/%3E%3Ctext fill=%27%23FFE81F%27 font-size=%2716%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27%3EImagen no encontrada%3C/text%3E%3C/svg%3E'">
                        <p>Altura: ${personaje.height} cm</p>
                        <p>Peso: ${personaje.mass} kg</p>
                        <p>A√±o nacimiento: ${personaje.birth_year}</p>
                    </div>
                `;

                log.innerHTML = `
                    ‚úÖ Conexi√≥n exitosa<br>
                    üõ∞Ô∏è SWAPI: OK<br>
                    üåê GitHub API: OK (${githubData.length} personajes disponibles)<br>
                    ‚è±Ô∏è Tiempo total: ${tiempo} ms
                `;
            } catch (err) {
                res.innerHTML = `<h2>‚ùå Error al conectar</h2>`;
                log.innerHTML = `‚ùå ${err.message}`;
            }
        }

        async function randomTest() {
            const res = document.getElementById('resultado');
            const log = document.getElementById('log');
            res.innerHTML = '<p>üåÄ Seleccionando elemento aleatorio...</p>';
            if (githubData.length === 0) {
                await testAPI();
            }

            const randomItem = githubData[Math.floor(Math.random() * githubData.length)];
            const tiempo = new Date().toLocaleTimeString();

            res.innerHTML = `
                <div class="card">
                    <h3>${randomItem.name}</h3>
                    <img src="${randomItem.image}" alt="${randomItem.name}"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27200%27 height=%27280%27%3E%3Crect fill=%27%23000%27 width=%27200%27 height=%27280%27/%3E%3Ctext fill=%27%23FFE81F%27 font-size=%2716%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27%3EImagen no encontrada%3C/text%3E%3C/svg%3E'">
                    <p><b>Especie:</b> ${randomItem.species || 'Desconocida'}</p>
                    <p><b>Afiliaci√≥n:</b> ${randomItem.affiliations?.[0] || 'N/A'}</p>
                </div>
            `;
            log.innerHTML = `
                üß© Test aleatorio completado<br>
                üî∏ Nombre: ${randomItem.name}<br>
                üåê Imagen cargada desde: ${randomItem.image}<br>
                ‚è∞ Hora: ${tiempo}
            `;
        }

        // üß† === Diagn√≥stico extendido ===
        async function verificarRecursos() {
            const diag = document.getElementById("diagnostico");
            diag.innerHTML = "<p>‚è≥ Analizando recursos...</p>";

            const resultados = {
                personajes: { total: 0, conImagen: 0, sinImagen: [] },
                naves: { total: 0, conImagen: 0, sinImagen: [] },
                peliculas: { total: 0, conImagen: 0, sinImagen: [] },
                planetas: { total: 0, conImagen: 0, sinImagen: [] }
            };

            try {
                // 1Ô∏è‚É£ PERSONAJES
                const resPers = await fetch("https://akabab.github.io/starwars-api/api/all.json");
                const personajes = await resPers.json();
                resultados.personajes.total = personajes.length;

                for (const p of personajes) {
                    const ok = await verificarImagen(p.image);
                    if (ok) resultados.personajes.conImagen++;
                    else resultados.personajes.sinImagen.push({ nombre: p.name, url: p.image });
                }

                // 2Ô∏è‚É£ NAVES
                const resNaves = await fetch("https://swapi.tech/api/starships");
                const navesData = await resNaves.json();
                resultados.naves.total = navesData.results.length;

                for (const n of navesData.results) {
                    const id = n.uid;
                    const imgUrl = `https://starwars-visualguide.com/assets/img/starships/${id}.jpg`;
                    const ok = await verificarImagen(imgUrl);
                    if (ok) resultados.naves.conImagen++;
                    else resultados.naves.sinImagen.push({ nombre: n.name, url: imgUrl });
                }

                // 3Ô∏è‚É£ PEL√çCULAS
                const resFilms = await fetch("https://swapi.tech/api/films");
                const filmsData = await resFilms.json();
                resultados.peliculas.total = filmsData.result.length;

                for (const f of filmsData.result) {
                    const id = f.uid;
                    const imgUrl = `https://starwars-visualguide.com/assets/img/films/${id}.jpg`;
                    const ok = await verificarImagen(imgUrl);
                    if (ok) resultados.peliculas.conImagen++;
                    else resultados.peliculas.sinImagen.push({ nombre: f.properties.title, url: imgUrl });
                }

                // üåç 4Ô∏è‚É£ PLANETAS
                const resPlanets = await fetch("https://swapi.tech/api/planets");
                const planetsData = await resPlanets.json();
                resultados.planetas.total = planetsData.results.length;

                for (const p of planetsData.results) {
                    const id = p.uid;
                    const imgUrl = `https://starwars-visualguide.com/assets/img/planets/${id}.jpg`;
                    const ok = await verificarImagen(imgUrl);
                    if (ok) resultados.planetas.conImagen++;
                    else resultados.planetas.sinImagen.push({ nombre: p.name, url: imgUrl });
                }

                diag.innerHTML = `
                    <div class="diagnostico">
                        <h3>üìà Resumen General</h3>
                        <ul>
                            <li>üë§ Personajes: ${resultados.personajes.conImagen}/${resultados.personajes.total}</li>
                            <li>üöÄ Naves: ${resultados.naves.conImagen}/${resultados.naves.total}</li>
                            <li>üé¨ Pel√≠culas: ${resultados.peliculas.conImagen}/${resultados.peliculas.total}</li>
                            <li>üåç Planetas: ${resultados.planetas.conImagen}/${resultados.planetas.total}</li>
                        </ul>

                        <h3 style="color:#FF5050;">‚ö†Ô∏è Im√°genes Faltantes</h3>

                        <details>
                            <summary>üë§ Personajes (${resultados.personajes.sinImagen.length})</summary>
                            <ul>${resultados.personajes.sinImagen.map(p => `<li>${p.nombre} ‚Üí <a href="${p.url}" target="_blank">${p.url}</a></li>`).join('')}</ul>
                        </details>

                        <details>
                            <summary>üöÄ Naves (${resultados.naves.sinImagen.length})</summary>
                            <ul>${resultados.naves.sinImagen.map(n => `<li>${n.nombre} ‚Üí <a href="${n.url}" target="_blank">${n.url}</a></li>`).join('')}</ul>
                        </details>

                        <details>
                            <summary>üé¨ Pel√≠culas (${resultados.peliculas.sinImagen.length})</summary>
                            <ul>${resultados.peliculas.sinImagen.map(f => `<li>${f.nombre} ‚Üí <a href="${f.url}" target="_blank">${f.url}</a></li>`).join('')}</ul>
                        </details>

                        <details>
                            <summary>üåç Planetas (${resultados.planetas.sinImagen.length})</summary>
                            <ul>${resultados.planetas.sinImagen.map(p => `<li>${p.nombre} ‚Üí <a href="${p.url}" target="_blank">${p.url}</a></li>`).join('')}</ul>
                        </details>
                    </div>
                `;
            } catch (err) {
                diag.innerHTML = `<p style="color:red;">‚ùå Error: ${err.message}</p>`;
            }
        }

        async function verificarImagen(url) {
            try {
                const res = await fetch(url, { method: "HEAD" });
                return res.ok;
            } catch {
                return false;
            }
        }
    </script>
</body>
</html>
